@use 'sass:map';
@use '../style/base';

$container-px: (
  'sm': map.get(base.$dim-container-px, 'sm'),
  'md': map.get(base.$dim-container-px, 'md'),
  'lg': map.get(base.$dim-container-px, 'lg'),
  'xl': map.get(base.$dim-container-px, 'xl'),
  'xxl': map.get(base.$dim-container-px, 'xxl'),
);
$tab-px: (
  'sm': 0.5rem,
  'md': 1.75rem,
  'lg': 4.25rem,
  'xl': 4.25rem,
  'xxl': 4.25rem,
);
$container-py: (
  'sm': 1.25rem,
  'md': 2.5rem,
  'lg': 3rem,
  'xl': 3rem,
  'xxl': 3rem,
);
$container-gx: (
  'sm': map.get(base.$dim-container-gx, 'sm'),
  'md': map.get(base.$dim-container-gx, 'md'),
  'lg': map.get(base.$dim-container-gx, 'lg'),
  'xl': map.get(base.$dim-container-gx, 'xl'),
  'xxl': map.get(base.$dim-container-gx, 'xxl'),
);
$container-gy: (
  'sm': map.get(base.$dim-container-gy, 'sm'),
  'md': map.get(base.$dim-container-gy, 'md'),
  'lg': map.get(base.$dim-container-gy, 'lg'),
  'xl': map.get(base.$dim-container-gy, 'xl'),
  'xxl': map.get(base.$dim-container-gy, 'xxl'),
);
$w-max: base.$dim-container-w-max;

.container {
  background-color: base.theme-get-val('surface');

  @include base.type-body;
}

.layout {
  margin-block: map.get($container-py, 'sm');

  @include base.style-md {
    margin-block: map.get($container-py, 'md');
  }

  @include base.style-lg {
    margin-block: map.get($container-py, 'lg');
  }

  @include base.style-xl {
    margin-block: map.get($container-py, 'xl');
  }

  @include base.style-xxl {
    margin-block: map.get($container-py, 'xxl');
  }
}

.title {
  &-container {
    width: min($w-max, 100% - 2 * map.get($container-px, 'sm'));
    margin-inline: auto;

    @include base.style-md {
      width: min($w-max, 100% - 2 * map.get($container-px, 'md'));
    }

    @include base.style-lg {
      width: min($w-max, 100% - 2 * map.get($container-px, 'lg'));
    }

    @include base.style-xl {
      width: min($w-max, 100% - 2 * map.get($container-px, 'xl'));
    }

    @include base.style-xxl {
      width: min($w-max, 100% - 2 * map.get($container-px, 'xxl'));
    }

    .tab {
      &[data-has-control='responsive'] {
        margin-inline: -1 *
          (map.get($container-px, 'sm') - map.get($tab-px, 'sm'));

        @include base.style-md {
          margin-inline: -1 *
            (map.get($container-px, 'md') - map.get($tab-px, 'md'));
        }

        @include base.style-lg {
          margin-inline: -1 *
            (map.get($container-px, 'lg') - map.get($tab-px, 'lg'));
        }

        @include base.style-xl {
          margin-inline: unset;
        }
      }

      &[data-has-control='true'] {
        margin-inline: -1 *
          (map.get($container-px, 'sm') - map.get($tab-px, 'sm'));

        @include base.style-md {
          margin-inline: -1 *
            (map.get($container-px, 'md') - map.get($tab-px, 'md'));
        }

        @include base.style-lg {
          margin-inline: -1 *
            (map.get($container-px, 'lg') - map.get($tab-px, 'lg'));
        }

        @include base.style-xl {
          margin-inline: -1 *
            (map.get($container-px, 'xl') - map.get($tab-px, 'xl'));
        }

        @include base.style-xxl {
          margin-inline: -1 *
            (map.get($container-px, 'xxl') - map.get($tab-px, 'xxl'));
        }
      }
    }
  }
}

.article {
  &-container {
    display: grid;
    grid-template-columns:
      minmax(map.get($container-px, 'sm'), 1fr) minmax(auto, $w-max)
      minmax(map.get($container-px, 'sm'), 1fr);
    grid-auto-rows: min-content;
    margin-inline: auto;

    @include base.style-md {
      grid-template-columns:
        minmax(map.get($container-px, 'md'), 1fr) minmax(auto, $w-max)
        minmax(map.get($container-px, 'md'), 1fr);
    }

    @include base.style-lg {
      grid-template-columns:
        minmax(map.get($container-px, 'lg'), 1fr) minmax(auto, $w-max)
        minmax(map.get($container-px, 'lg'), 1fr);
    }

    @include base.style-xl {
      grid-template-columns:
        minmax(map.get($container-px, 'xl'), 1fr) minmax(auto, $w-max)
        minmax(map.get($container-px, 'xl'), 1fr);
    }

    @include base.style-xxl {
      grid-template-columns:
        minmax(map.get($container-px, 'xxl'), 1fr) minmax(auto, $w-max)
        minmax(map.get($container-px, 'xxl'), 1fr);
      column-gap: 1.5rem;
    }
  }

  &-index-container {
    position: relative;
    grid-row: 1;
    grid-column: 2;

    @include base.style-xxl {
      grid-row: 1;
      grid-column: 3;
    }
  }

  &-index {
    position: sticky;
    top: 0;

    @include base.type-label-lg;

    ul {
      list-style: none;
    }
  }

  grid-row: 2;
  grid-column: 2;
  word-break: break-all;
  overflow-wrap: anywhere;

  @include base.style-md {
    word-break: keep-all;
    overflow-wrap: break-word;
  }

  @include base.style-xxl {
    grid-row: 1;
    grid-column: 2;
  }

  &-quote {
    @include base.type-subtitle;

    &-text {
      box-sizing: content-box;
      max-width: base.$dim-hangul-20ch * 2;
      padding-left: 12px - 2px;
      text-wrap: balance;
      word-break: keep-all;
      overflow-wrap: break-word;
      border-left: 2px solid base.theme-get-val('primary');

      @include base.style-md {
        padding-left: 16px - 2px;
      }
    }
  }

  &-column {
    display: flex;
    flex-wrap: wrap;
    gap: 24px;
    justify-content: center;

    img {
      align-self: start;
      width: 360px;
    }

    &-text {
      flex-basis: base.$dim-hangul-20ch;
      flex-grow: 1;

      @include base.type-body;
    }
  }

  a {
    color: base.theme-get-val('link');
    text-decoration: none;

    &:hover {
      color: base.theme-get-val('link-hover');
      text-decoration: underline;
    }
  }

  strong {
    font-weight: 500;
    color: base.theme-get-val('quaternary');
  }

  p {
    max-width: base.$dim-hangul-20ch * 3;

    // p태그 직후의 p태그: 문단 사이
    + p {
      margin-top: 8px;

      @include base.style-md {
        margin-top: 12px;
      }
    }

    // p태그 직후의 div들: 문단 사이
    + div {
      margin-top: 8px;

      @include base.style-md {
        margin-top: 12px;
      }
    }

    // h1, h2, h3, h4, h5, h6 직전의 p태그: 마지막 문단
    &:has(+ h1),
    &:has(+ h2),
    &:has(+ h3),
    &:has(+ h4),
    &:has(+ h5),
    &:has(+ h6) {
      margin-bottom: 16px;

      @include base.style-md {
        margin-bottom: 24px;
      }
    }
  }

  div {
    // div태그 직후의 p태그: 문단 사이
    + p {
      margin-top: 8px;

      @include base.style-md {
        margin-top: 12px;
      }
    }

    // div태그 직후의 div들: 문단 사이
    + div {
      margin-top: 8px;

      @include base.style-md {
        margin-top: 12px;
      }
    }

    // h1, h2, h3, h4, h5, h6 직전의 div태그: 마지막 문단
    &:has(+ h1),
    &:has(+ h2),
    &:has(+ h3),
    &:has(+ h4),
    &:has(+ h5),
    &:has(+ h6) {
      margin-bottom: 16px;

      @include base.style-md {
        margin-bottom: 24px;
      }
    }
  }

  h5,
  h6 {
    // h5, h6태그 직후의 p, div태그: 제목 후 첫 문단
    + p,
    + div {
      padding-top: 8px;

      // padding-top: 8px;
      border-top: 1px solid base.theme-get-val('outline-variant');

      @include base.style-md {
        // padding-top: 12px;
        padding-top: 16px;
      }
    }
  }
}
